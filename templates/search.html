{% extends "base.html" %} 
{% from "tweet_conversation.html" import render_tweet_conversation %}
{% from "base.html" import render_pagination %}
{% block title %}搜索 - LocalTwitter{% endblock %} {% block content %}
<div class="header">
  <h1>搜索</h1>
  <button id="theme-toggle" class="theme-toggle">
    <i class="fas fa-moon"></i>
  </button>
</div>

<div class="nav">
  <a href="/">时间线</a>
  <a href="/stats">统计</a>
  <a href="/search" class="active">搜索</a>
</div>

<div class="search-box">
  <form method="GET" action="/search">
    <div class="search-filters">
      <input
        type="text"
        name="q"
        value="{{ query }}"
        placeholder="搜索推文内容..."
        class="search-input" />
      
      <select name="year" class="search-select">
        <option value="">选择年份</option>
        <option value="2024" {% if year == "2024" %}selected{% endif %}>2024</option>
        <option value="2023" {% if year == "2023" %}selected{% endif %}>2023</option>
        <option value="2022" {% if year == "2022" %}selected{% endif %}>2022</option>
        <option value="2021" {% if year == "2021" %}selected{% endif %}>2021</option>
        <option value="2020" {% if year == "2020" %}selected{% endif %}>2020</option>
        <option value="2019" {% if year == "2019" %}selected{% endif %}>2019</option>
        <option value="2018" {% if year == "2018" %}selected{% endif %}>2018</option>
        <option value="2017" {% if year == "2017" %}selected{% endif %}>2017</option>
        <option value="2016" {% if year == "2016" %}selected{% endif %}>2016</option>
        <option value="2015" {% if year == "2015" %}selected{% endif %}>2015</option>
      </select>
      
      <select name="month" class="search-select">
        <option value="">选择月份</option>
        <option value="1" {% if month == "1" %}selected{% endif %}>1月</option>
        <option value="2" {% if month == "2" %}selected{% endif %}>2月</option>
        <option value="3" {% if month == "3" %}selected{% endif %}>3月</option>
        <option value="4" {% if month == "4" %}selected{% endif %}>4月</option>
        <option value="5" {% if month == "5" %}selected{% endif %}>5月</option>
        <option value="6" {% if month == "6" %}selected{% endif %}>6月</option>
        <option value="7" {% if month == "7" %}selected{% endif %}>7月</option>
        <option value="8" {% if month == "8" %}selected{% endif %}>8月</option>
        <option value="9" {% if month == "9" %}selected{% endif %}>9月</option>
        <option value="10" {% if month == "10" %}selected{% endif %}>10月</option>
        <option value="11" {% if month == "11" %}selected{% endif %}>11月</option>
        <option value="12" {% if month == "12" %}selected{% endif %}>12月</option>
      </select>
      
      <button type="submit" class="search-button">搜索</button>
    </div>
  </form>
</div>

<div class="tweets-container">
  {% for tweet in tweets %} {{ render_tweet_conversation(tweet) }} {% endfor %}
</div>

{% if pagination %}
{% set search_params = [] %}
{% if query %}{% set _ = search_params.append("q=" + query) %}{% endif %}
{% if year %}{% set _ = search_params.append("year=" + year) %}{% endif %}
{% if month %}{% set _ = search_params.append("month=" + month) %}{% endif %}
{% set base_url = "/search?" + search_params|join("&") + "&" if search_params else "/search?" %}
{{ render_pagination(pagination, page, total_pages, base_url) }}
{% endif %}

{% if (query or year or month) and tweets|length == 0 %}
<div class="empty">
  <p>未找到符合条件的推文</p>
</div>
{% endif %} {% if not query and not year and not month %}
<div class="empty">
  <p>请输入搜索条件</p>
</div>
{% endif %} {% endblock %}
