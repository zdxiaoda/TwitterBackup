{% extends "base_modern.html" %}
{% from "components/header.html" import render_header %}
{% from "components/navigation.html" import render_navigation %}
{% from "tweet_conversation.html" import render_tweet_conversation %}
{% from "base_modern.html" import render_pagination %}

{% block title %}搜索 - LocalTwitter{% endblock %}

{% block content %}
  {{ render_header("搜索") }}
  {{ render_navigation("search") }}

  <div class="search-box">
    <form method="GET" action="/search">
      <div class="search-filters">
        <input
          type="text"
          name="q"
          value="{{ query }}"
          placeholder="搜索推文内容..."
          class="search-input" />
        
        <select name="year" class="search-select">
          <option value="">选择年份</option>
          <option value="2025" {% if year == "2025" %}selected{% endif %}>2025</option>
          <option value="2024" {% if year == "2024" %}selected{% endif %}>2024</option>
          <option value="2023" {% if year == "2023" %}selected{% endif %}>2023</option>
          <option value="2022" {% if year == "2022" %}selected{% endif %}>2022</option>
          <option value="2021" {% if year == "2021" %}selected{% endif %}>2021</option>
         </select>
        
        <select name="month" class="search-select">
          <option value="">选择月份</option>
          <option value="1" {% if month == "1" %}selected{% endif %}>1月</option>
          <option value="2" {% if month == "2" %}selected{% endif %}>2月</option>
          <option value="3" {% if month == "3" %}selected{% endif %}>3月</option>
          <option value="4" {% if month == "4" %}selected{% endif %}>4月</option>
          <option value="5" {% if month == "5" %}selected{% endif %}>5月</option>
          <option value="6" {% if month == "6" %}selected{% endif %}>6月</option>
          <option value="7" {% if month == "7" %}selected{% endif %}>7月</option>
          <option value="8" {% if month == "8" %}selected{% endif %}>8月</option>
          <option value="9" {% if month == "9" %}selected{% endif %}>9月</option>
          <option value="10" {% if month == "10" %}selected{% endif %}>10月</option>
          <option value="11" {% if month == "11" %}selected{% endif %}>11月</option>
          <option value="12" {% if month == "12" %}selected{% endif %}>12月</option>
        </select>
        
        <button type="submit" class="btn btn-primary">搜索</button>
      </div>
    </form>
  </div>

  <div class="tweets-container">
    {% for tweet in tweets %}
      {{ render_tweet_conversation(tweet) }}
    {% endfor %}
  </div>

  {% if pagination %}
    {% set search_params = [] %}
    {% if query %}{% set _ = search_params.append("q=" + query) %}{% endif %}
    {% if year %}{% set _ = search_params.append("year=" + year) %}{% endif %}
    {% if month %}{% set _ = search_params.append("month=" + month) %}{% endif %}
    {% set base_url = "/search?" + search_params|join("&") + "&" if search_params else "/search?" %}
    {{ render_pagination(pagination, page, total_pages, base_url) }}
  {% endif %}

  {% if (query or year or month) and tweets|length == 0 %}
    <div class="empty">
      <p>未找到符合条件的推文</p>
    </div>
  {% endif %}

  {% if not query and not year and not month %}
    <div class="empty">
      <p>请输入搜索条件</p>
    </div>
  {% endif %}
{% endblock %}
